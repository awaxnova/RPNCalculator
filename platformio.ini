[platformio]
default_envs = esp32_debug
description = ESP32-32E + ST7796S(320x480) + XPT2046 touch + LVGL

[env]
platform = espressif32@6.6.0
framework = arduino
board = esp32dev
board_build.flash_mode = qio
board_build.filesystem = littlefs
monitor_speed = 115200
upload_speed = 921600

lib_deps =
  bodmer/TFT_eSPI @ ^2.5.43
  lvgl/lvgl @ ^9.2.0
  bblanchon/ArduinoJson @ ^7.1.0

; Generate version header
extra_scripts = scripts/version_header.py

; Custom partition (app + FS)
board_build.partitions = partitions/app_fs_4MB.csv

; ==== Display/Touch Wiring (your board) ====
; LCD on HSPI: MOSI=13, MISO=12, SCLK=14, CS=15, DC=2, RST tied to EN (-1), BL=27
; Touch XPT2046: CS=33, IRQ=36 (on same SPI)
; SD (VSPI default): CS=5 (CLK=18, MOSI=23, MISO=19)
build_flags =
  -D SERIAL_BAUD=115200
  -D CORE_DEBUG_LEVEL=1
  -D USER_SETUP_LOADED
  -D ST7796_DRIVER
  -D TFT_RGB_ORDER=0
  -D TFT_BACKLIGHT_ON=HIGH
  -D TFT_SPI_PORT=HSPI
  -D SPI_FREQUENCY=40000000
  -D SPI_READ_FREQUENCY=16000000
  -D SPI_TOUCH_FREQUENCY=2500000
  -D TFT_MOSI=13
  -D TFT_MISO=12
  -D TFT_SCLK=14
  -D TFT_CS=15
  -D TFT_DC=2
  -D TFT_RST=-1
  -D TFT_BL=27
  -D TOUCH_CS=33
  -D TOUCH_IRQ=36
  -D SD_CS=5

[env:esp32_debug]
build_type = debug
build_flags =
  ${env.build_flags}
  -D BUILD_FLAVOR_DEBUG
  -Og -g3 -fno-inline

[env:esp32_release]
build_type = release
build_flags =
  ${env.build_flags}
  -D BUILD_FLAVOR_RELEASE
  -O2
